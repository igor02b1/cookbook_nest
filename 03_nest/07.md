<h1>Projeto 02 - Blog Pessoal - Classes PostagemController e PostagemService - M√©todo Listar Tudo</h1>

O que veremos por aqui:

1. Criar a Classe PostagemService
2. Criar a Classe PostagemController
3. Criar o m√©todo findAll() para listar todas as Postagens
4. Registrar as 2 Classes no M√≥dulo PostagemModule
5. Testar o M√©todo no Insomnia

<h2>1. O M√≥dulo Postagem</h2>

Na etapa anterior, come√ßamos a construir o **M√≥dulo Postagem**, a partir da **Classe Entity (Model) Postagem**, onde implementamos todos os atributos do recurso e geramos a tabela **tb_postagem** dentro do nosso Banco de dados **db_blogpessoal**. Agora vamos come√ßar a criar os 6 M√©todos da Classe Postagem, listados no Diagrama de Classes abaixo, nas Classes **PostagemService** e **PostagemController**.

<div align="center"><img src="https://i.imgur.com/onsKbGc.jpg" title="source: imgur.com" width="75%"/></div>

A Classe **PostagemService** ser√° a Classe de Servi√ßo, ou seja, onde implementaremos as regras de neg√≥cio da aplica√ß√£o. A Classe **PostagemController** ser√° a Classe Controladora do M√≥dulo Postagem, ou seja, ela ir√° responder toda e qualquer Requisi√ß√£o (HTTP Request), que for enviada de fora da aplica√ß√£o para o Recurso Postagem. 

> **Regras de neg√≥cio:**  O termo regras de neg√≥cio refere-se √†s **diretrizes que definem ou restringem a√ß√µes, mostrando como M√©todos devem funcionar, o que deve ser checado e quais as suas limita√ß√µes nessa aplica√ß√£o**. Essas regras s√£o importantes para que pessoa desenvolvedora tenha uma vis√£o clara do que deve ser feito, como e por qual raz√£o.

N√≥s iremos implementar os m√©todos do **CRUD (Create, Read, Update e Delete)** nas duas Classes, com a diferen√ßa de que na Classe de Servi√ßo o M√©todo far√° o processamento dos dados enviados na Requisi√ß√£o, enquanto na Classe Controladora, o M√©todo receber√° a Requisi√ß√£o, enviar√° os dados para a Classe de Servi√ßo, e ap√≥s o processamento da Requisi√ß√£o ela enviar√° uma Resposta com o resultado do processamento. 

<h2>üë£ Passo 01 - Criar a Classe de Servi√ßo PostagemService</h2>

Vamos criar a pasta **services**, dentro do nosso **M√≥dulo Postagem** (pasta postagem):

1. Na pasta **postagem**, clique com o bot√£o direito do mouse e clique na op√ß√£o **New Folder** (Nova Pasta). 

<div align="center"><img src="https://i.imgur.com/uCdfiD7.png" title="source: imgur.com" /></div>

2. O nome da pasta ser√° **services**, como mostra a figura abaixo. Ap√≥s digitar o nome da pasta, pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/Yv9yU9I.png" title="source: imgur.com" /></div>

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar a Classe de Servi√ßo. Um erro muito comum √© criar a pasta services fora da pasta do m√≥dulo (postagem).* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

Na sequ√™ncia, vamos criar a Classe de Servi√ßo **PostagemService** que chamaremos de **postagem.service.ts**.

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="220px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar Classe de Servi√ßo. Um erro muito comum √© digitar o nome da Classe de forma incorreta. O nome da Classe deve estar dentro dos padr√µes do Nest para evitar erros na sua aplica√ß√£o.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

1. Clique com o bot√£o direito do mouse sobre a **pasta services**, que foi criada dentro da pasta **postagem**, como mostra a figura abaixo, **New File** (Novo Arquivo).

<div align="center"><img src="https://i.imgur.com/4ih83IQ.png" title="source: imgur.com" /></div>

2. O nome do arquivo ser√° **postagem.service.ts**, como mostra a figura abaixo. Ap√≥s digitar o nome do arquivo, pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/ttqqIuG.png" title="source: imgur.com" /></div>

Agora vamos come√ßar a criar o c√≥digo da Classe **PostagemService**, como mostra a figura abaixo. Como iremos construir 6 M√©todos dentro da Classe de Servi√ßo, vamos construir por partes. Aqui construiremos apenas o primeiro M√©todo, o **findAll()**, que tem como objetivo listar todas as Postagens persistidas no Banco de dados.

<div align="left"><img src="https://i.imgur.com/7XE7kiZ.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo:

**Linha 1:** Importamos o pacote **Common** com os respectivos **Decorators**, utilizados na implementa√ß√£o da Classe Postagem.

**Linha 2:** Importamos o pacote **TypeORM** com os respectivos **Decorators**, utilizados na implementa√ß√£o da Classe Postagem.

**Linha 3:** Importamos a Classe **Repository**, do M√≥dulo **typeorm**, do pacote **TypeORM**. 

**Linha 4:** Importamos a Classe **Postagem**, do M√≥dulo **Postagem**.

**Linha 6:** O Decorator **@Injectable** indica que a classe √© do tipo Service, ou seja, uma Classe de Servi√ßo e pode ser Injetada em outras Classes atrav√©s da **Inje√ß√£o de Depend√™ncias**.

**Linha 8:** Cria um Construtor, que receber√° as Inje√ß√µes de Depend√™ncia.

**Linhas 9:** O Decorator **@InjectRepository(Postagem)** √© a  implementa√ß√£o  utilizada pelo  TypeORM para  aplicar  a  Invers√£o  de  Controle (IoC)  quando  for necess√°rio. A Inje√ß√£o de Depend√™ncia define quais Classes ser√£o instanciadas automaticamente e em quais lugares ser√£o Injetadas quando houver necessidade.

Em nosso exemplo, a Classe de Servi√ßo cria um ponto de inje√ß√£o da **Classe Entidade Postagem** e quando houver a necessidade o TypeORM cria um novo **Objeto da Classe Postagem** a partir da Interface **Repository**. A grande vantagem de se utilizar a Inje√ß√£o de Depend√™ncias √© que voc√™ consegue instanciar e acessar os Objetos sem a necessidade de criar M√©todos Construtores na Classe Entidade ou criar/instanciar Objetos de forma manual, semelhante ao que era feito em POO no Bloco 1. Estamos transferindo esta responsabilidade para o TypeORM e desta forma nos preocuparemos apenas com o processamento das Requisi√ß√µes HTTP.

> A Interface **Repository** nos auxilia na intera√ß√£o com o Banco de dados. Esta Interface cont√©m diversos  m√©todos pr√©-implementados para a manipula√ß√£o dos dados de uma Entidade, como os m√©todos para salvar, deletar, listar e alterar dados dos objetos persistidos no Banco de dados. Outra vantagem da Interface Repository √© que os M√©todos de consulta permitem criar qualquer consulta SQL que voc√™ precisar.

**Linha 10:** Definimos o nome do Objeto da Interface Repository (**postagemRepository**), que receber√° a Inje√ß√£o de Depend√™ncias e utilizaremos para implementar os M√©todos da Interface.

**Linha 13:** Criamos o M√©todo Ass√≠ncrono (async), chamado **findAll()**, que promete retornar uma **Promise** com um array de Objetos Postagem. Como o M√©todo findAll() lista v√°rios Objetos √© necess√°rio criar um array para armazenar todos os Objetos.

**Linha 14:** Retorna a execu√ß√£o do M√©todo **find()**, da Interface **postagemRepository**. Tra√ßando um paralelo com o MySQL, o M√©todo find() seria o equivalente a instru√ß√£o: <code>SELECT * FROM tb_postagens;</code>, que lista todas as postagens da Tabela. Observe que na instru√ß√£o **return** foi inserido o comando **await** (aguarde), que na pr√°tica significa espere que a **Promise** seja resolvida (os Objetos Postagem sejam inseridos no array de Objetos Postagem criados na Promise na linha 13), antes de retornar a execu√ß√£o do M√©todo e o valor resolvido para a Classe que acionou o M√©todo.

> **Promise:** √â um objeto usado para processamento ass√≠ncrono. Uma Promise na pr√°tica √© uma promessa, que representa um valor que pode estar dispon√≠vel agora, no futuro ou nunca. Uma Promise √© como um "procurador" para um valor que n√£o √© necessariamente conhecido quando a promessa √© criada. Isso permite a associa√ß√£o de m√©todos de tratamento para eventos da a√ß√£o ass√≠ncrona num caso eventual de sucesso ou de falha. Isto permite que  m√©todos ass√≠ncronos retornem valores como m√©todos s√≠ncronos: ao inv√©s do valor final, o m√©todo ass√≠ncrono retorna uma *promessa* ao valor em algum momento no futuro.
>
> Uma Promise pode ter 3 estados: 
>
> - *pending (*pendente*)*: Estado inicial, que n√£o foi realizada nem rejeitada.
> - *fulfilled (*resolvida): sucesso na opera√ß√£o.
> - *rejected (*rejeitado):  falha na opera√ß√£o.

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/providers" target="_blank"><b>Documenta√ß√£o: <i>Provedores - Classe de Servi√ßo</i></b></a>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/fundamentals/custom-providers" target="_blank"><b>Documenta√ß√£o: <i>Provedores Customizados - Classe de Servi√ßo</i></b></a>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/techniques/database" target="_blank"><b>Documenta√ß√£o: <i>Interface Reposit√≥rio</i></b></a>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank"><b>Documenta√ß√£o: Promise</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/async_function" target="_blank"><b>Documenta√ß√£o: Async</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/await" target="_blank"><b>Documenta√ß√£o: Await</b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="35px"/> <a href="mudar" target="_blank"><b>C√≥digo fonte da Classe PostagemService</b></a>

<br /><br />
	
<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
